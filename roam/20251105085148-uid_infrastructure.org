:PROPERTIES:
:ID:       7a0922df-453a-4788-bb9c-90d3ff52f163
:END:
#+title: UID infrastructure
#+STARTUP: overview
* taking back control of infrastructure                                :@uid:
** create a dependency graph of our services
** infra git
https://gitlab2.uid.ir/services/docker-compose-file
https://gitlab2.uid.ir/infrastructure/platform-infra
** get address of grafana
https://grafana.u-id.ir
*** TODO password of grafana
:LOGBOOK:
- State "TODO"       from              [2025-11-24 Mon 20:58]
:END:
** elastic

elastic
KanUup6P9l
** get address of 
** argocd
https://argocd.u-id.ir/
admin
dUOTk0JWeWnTu
*** TODO how do i change argocd password
:LOGBOOK:
- State "TODO"       from              [2025-11-24 Mon 20:57]
:END:
** adminer
https://adminer.u-id.ir
** control of servers
*** DELEGATED get list of servers
:LOGBOOK:
- State "DELEGATED"  from              [2025-11-05 Wed 08:52]
:END:
*** get access to kubernates

*** get access to monitoring
**** elastic
http://46.245.89.2:5601/login?next=%2F
elastic
KanUup6P9l
** connecting to kubernates
*** dependencies
  - kubectl
  - k9s
*** credential
#+NAME: kube_certificate
#+BEGIN_SRC yaml
apiVersion: v1
clusters:
- cluster:
    certificate-authority-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURCVENDQWUyZ0F3SUJBZ0lJZVQ2YUNvb3g0eHN3RFFZSktvWklodmNOQVFFTEJRQXdGVEVUTUJFR0ExVUUKQXhNS2EzVmlaWEp1WlhSbGN6QWVGdzB5TlRBMk1EZ3dOelE1TkRSYUZ3MHpOVEEyTURZd056VTBORFJhTUJVeApFekFSQmdOVkJBTVRDbXQxWW1WeWJtVjBaWE13Z2dFaU1BMEdDU3FHU0liM0RRRUJBUVVBQTRJQkR3QXdnZ0VLCkFvSUJBUUNtaUp5cC9nMlhIU0tTWHRmc1FaMTlCTStkc2djTUhNWlA3NmhhcnQzc21BRDlCKzNGb3A4Q0o0Mm8KVVFvc2ZFb2VUQzhSbnpLajBEelgxSEU3eVpZYUtNR1FIWmo4VU5RaGttS092R09RcGk2TUttbmVwNXB4ODJNRgpaUzNBNXMva1R3NmNhVXZnbHFhNXJBNkZjNnAzTUZ3enFqL0dBbWNYNVFjbTMwVTI4RlBBM1Q2eUw0WHBwaHlHCkdJUUdkNjE4eWlsNElDU0Fqemc2VE1pMENBWnhLVjROcTU2dm1teXdPU3QwTUx4U2pmNWdUNmd2eTViRytqc2gKeEIwMU01aDYwcWVSOGxJazE5dml0UDRiSkpkQkYxdXRlbkNXbE1WZGd0eGN5LzJFN1lDM3ZqanhpRWRpZ21uSgpEazBKOHRuV0QwV1kvVEJoTGozeERSVjF3c2hqQWdNQkFBR2pXVEJYTUE0R0ExVWREd0VCL3dRRUF3SUNwREFQCkJnTlZIUk1CQWY4RUJUQURBUUgvTUIwR0ExVWREZ1FXQkJRblhlN09uSVRuZ2VISi9oZUtYMUVyUDdtWVRqQVYKQmdOVkhSRUVEakFNZ2dwcmRXSmxjbTVsZEdWek1BMEdDU3FHU0liM0RRRUJDd1VBQTRJQkFRQm1RMXMwbi9GbQpuQ0Z5djU4YVdqSTdFTXAwN3hTNVRFd2Ivajg4a1EzM0FIc0ZnQnU3ZFJ2RWJjRW9Ba3hqRXFQUzNRTjBtNW1MCjdDaVdramtRVEkvTzMxN2JhampXK3lFSFI2ekd3NEVpcmppMGhXVjU3Y3p4RmxDa1ByNExEcmVwbXhjTzlzR0gKclFWWWJ5dGNRMHBIOUhFVUhOTnY4amFBVVJ6QzNWb0VaVUVJRmhhTHpVbHE3dUU1M0o0YXVCdk5nd1krci9iRwpkVytYbTkySFRTNG5KcURMdkpEZnBDODUxVTNiVlZlWVRoMlI2OUFSNm1mTUtEVEQwZDhzMWlwY3VxMVVhMUZRCjBZU1k3b3pRTDRkSWlXQktzZzBVdDRlMmhwY0lZY0pHaGk5TTB3K1FvZkVMaHJHZkE3NVl1TjJoOEpDMjNjUGIKWFdHcmRsdUg5ZWpvCi0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
    server: https://k8s-lb.internal:6443
  name: kubernetes
contexts:
- context:
    cluster: kubernetes
    user: kubernetes-admin
  name: kubernetes-admin@kubernetes
current-context: kubernetes-admin@kubernetes
kind: Config
preferences: {}
users:
- name: kubernetes-admin
  user:
    client-certificate-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURLVENDQWhHZ0F3SUJBZ0lJT3BOdFdXN0dheWN3RFFZSktvWklodmNOQVFFTEJRQXdGVEVUTUJFR0ExVUUKQXhNS2EzVmlaWEp1WlhSbGN6QWVGdzB5TlRBMk1EZ3dOelE1TkRSYUZ3MHlOakEyTURnd056VTBORFJhTUR3eApIekFkQmdOVkJBb1RGbXQxWW1WaFpHMDZZMngxYzNSbGNpMWhaRzFwYm5NeEdUQVhCZ05WQkFNVEVHdDFZbVZ5CmJtVjBaWE10WVdSdGFXNHdnZ0VpTUEwR0NTcUdTSWIzRFFFQkFRVUFBNElCRHdBd2dnRUtBb0lCQVFEMnNyZGwKLzIwRk1YYnBUR3pGc1pZZzMraWNDazdibHRWSFVySG1NYy92SUJ0Y21mazJYbjVRYzZIYWpQN2FJOGpmOWNsRQpzWDd5TWVpZ054cFlMbG0vRXZKeDZUOEVxTGNrN1IwRTRBcStTVGwvZzFXUXp2MzVBTWIzamZ4VW5URlluNXcyCmFwOVJFMDhWMElMN1lkQ3hjcFdlUXRYUVlVTER4UXAwSCs5Z0NEU1RiMVRPcE5YMUUvc0E5ZTVHZkplbnJ5M1AKeDdhblBxMnZheC95SkRFUlB3d2RncFRmS3dFaUsxWnluZ09IZXZrTFVqQ09zandiZ24zbm9QcHZjWFhhU0xJcwpkQjRFUUFzaldWY3Y0K1B1aTNnZ3VnMEVsNGE2S0FZalRGOERpZThYcStWL1RTanRyV2l5aFJuUlRDeWErMHNQCjVEUGF0UkUwTHIyeHZIbEhBZ01CQUFHalZqQlVNQTRHQTFVZER3RUIvd1FFQXdJRm9EQVRCZ05WSFNVRUREQUsKQmdnckJnRUZCUWNEQWpBTUJnTlZIUk1CQWY4RUFqQUFNQjhHQTFVZEl3UVlNQmFBRkNkZDdzNmNoT2VCNGNuKwpGNHBmVVNzL3VaaE9NQTBHQ1NxR1NJYjNEUUVCQ3dVQUE0SUJBUUFWWUxaOXQ2ZU1oTHFxQkg4MDMrcXFQWHlKCnhwcTVHNXNUZXo5MFdmN3VodjlTQ1pqZy85dDYrQ25FKytCT0t2MzNIK01tVjhVWFlNYXh2YmVUMFI3QzlGaEcKV1NtQ1IyQ09iSEZvbGdjaFlnUXlmVkhBRVJQbEVCNXE5cFpsUnUzWEV3dVJCK3JzRFE2aW8rRkV4dTNKa0x2cApPa2ZiWS9ibFkyUGxwNDZDeEFBT3VudzBVdGdwNG1nOTJPbWRyYy8ydlNJdk5FbjhNYjdtVkpJUUczU253LzdaCmJIWm15QkJrTGJtd3QvTno5NTcxTjhpNndZbjNIZWZ0UitpTWRWNzZZN3FRbFFnbFBxbUdka2E4QVlHUVYzNGwKWFI0N0svQzFGcFJlY1ZvS2xVbUVXcUhaWVh3a0hrOWpWMXdvRDVSOHFBR0dvaXdBeGZKV2VjYXJIcUhuCi0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
    client-key-data: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFb3dJQkFBS0NBUUVBOXJLM1pmOXRCVEYyNlV4c3hiR1dJTi9vbkFwTzI1YlZSMUt4NWpIUDd5QWJYSm41Ck5sNStVSE9oMm96KzJpUEkzL1hKUkxGKzhqSG9vRGNhV0M1WnZ4THljZWsvQktpM0pPMGRCT0FLdmtrNWY0TlYKa003OStRREc5NDM4VkoweFdKK2NObXFmVVJOUEZkQ0MrMkhRc1hLVm5rTFYwR0ZDdzhVS2RCL3ZZQWcwazI5VQp6cVRWOVJQN0FQWHVSbnlYcDY4dHo4ZTJwejZ0cjJzZjhpUXhFVDhNSFlLVTN5c0JJaXRXY3A0RGgzcjVDMUl3CmpySThHNEo5NTZENmIzRjEya2l5TEhRZUJFQUxJMWxYTCtQajdvdDRJTG9OQkplR3VpZ0dJMHhmQTRudkY2dmwKZjAwbzdhMW9zb1VaMFV3c212dExEK1F6MnJVUk5DNjlzYng1UndJREFRQUJBb0lCQUZvNHdobnJjRk9WNDRjdgpEQmpBK2NiTUhLWDBueUp2NTFCT1RnR0I5aW5kOUNQSnEvcldWQnZZTGpsZmwxVHdBV2JtM05UaWxTcStWZlZDCk1jQk9NMFJPQ1p6ZlVNekRaemQ2QUVMb0xRV3FnZnpBYTJxcVNQZm44TnhZY1JBQTdTc2NOR1V5V1ZHdFhoNzgKUXVyc3V3WXFnYzEvWS9MeG54azUxcmpoZFFvSlBsdVdtZGtOd3RuSlkrZmtrZ3RWa3pCOW9QZWxMa3JQaDVWVgpWb0NxOXRtNFpvSVRrL2FrR2ZsU3llV3RZUXRrTzlaTjF4Nm5ZUjl2WXcvVVhrRURCcHQ1NzNHUGliY1pzaml5CnNIdzZjanFtMnZjNk9iNWtLb3ZaTHRVNVV3cDJuVUQ5L1FyZE5mSi92eklDNlFPSTBpTmJvUnNWN3FLSkJPTzMKanV2TDRRRUNnWUVBL3RIU292MVVMK0dVbG1nNlAwVzZkYnZIV0VPTFR0eDF5dllONStDK0svSVpDYTAxdVhzdwpZMWQySkRweENucEQrOHVQbkhtbDlOaEw0WGdnNDl0Tmt0MmlkdlZIbGpoT1RYSDVQQ0hlV2U0SmxCSXhBM052Cm4wb1BPRkd0MkJmRnFLMEhYaS9BY0NGWXJrUUJGQmhYeXpsK0lkQWlwUkkwNlVhdExRVGIwSHNDZ1lFQTk5ZEQKUWpvcHVvQzlTQXNrVmZmS1dlajkzUzZGSktGemxXMkZGUGh1cDhOaTJIVWwvOXBTbnRnK09CdzkvWkoweHA4RQpEdjRxQkRMNUQvZjNPTjc2Y3VWbTRqcEN6QlZrZTRmM2E0N0NaTjBKQWllWjhnLzdZRUtaWDV2ZkNYR2xGdjlmCktwZGpBOUx2WHFSKzh0cnhhaU1pNFpLUWsvMlJLb2FxWVhqN0xxVUNnWUVBaXo1VS84TzJrVU9QVW5FNkF3RXoKVnNwNXIvMll6a3NpQXZwWnR1L1VlMmNiejNIYS9iUVhTUEd1R1RYbU4zZUFWc054Z212bkI5aDUvb2NLVWZpdwpkeVN0ZHB1cHRxaW1BU1Bhc2NWQUg1dzNsN1lwR2wybURVRUcrQnVLQjU5VjMwcE4wR1gvbmtaYWt6K041MUUyCkNGTXVYWVBDcXJrOE9JenFiTU5PNnFrQ2dZQUcrVE9YUlhPdkg3Z3pzcnlPL3EzZTRjTmkyZEE5TzUyNDhwL3YKK3gyQjh1bHhGYnEvL0RDZTc0NnduWHJSQzdIbGRNdjBjQXBXbStpT0huZ0NUYVBXWDhZSlQ0SlpvN0IwR1Z0SQoxM2Q0eHc5ZDFDZHN2QzVpZ3YwMXgzajdGd3VDSGlWYldXOGJ5RytieGgwY1VEVEN1OEpiZm5nNjhjT0g0c29nCmUvcjFVUUtCZ0QxbjlRREpteVEvckRiaVVNaUlOb1Y3emJvVEs3M3FtdW9sMU03WGZYMkdaemxsZExWYmZCZ2YKdk05bitGZUhqdndSS3QrUTVNQmVzOFlrVVY3VGNsb250anBMcjZTS0VEbVZUM1JZcUtaN2ROSVBQMGttN1FxVgpRaUFxc3Q3L2w3M3lxbkNQTE0wZVJIRjJKQW5QU1lGaTNnTEg4NFlHU3ZvcEc3Wm1BYmpvCi0tLS0tRU5EIFJTQSBQUklWQVRFIEtFWS0tLS0tCg==

#+END_SRC


#+begin_src sh
sudo echo "46.245.89.9 k8s-lb.internal" >> /etc/hosts
#+end_src

#+RESULTS:
*** connection
k9s  --kubeconfig  ~/.kube/config

:namespace production
** DONE access to backups
CLOSED: [2025-11-26 Wed 13:05] SCHEDULED: <2025-11-10 Mon>
:LOGBOOK:
- State "DONE"       from "TODO"       [2025-11-26 Wed 13:05]
- State "TODO"       from              [2025-11-07 Fri 10:38]
:END:
** DONE get access to vmwave
CLOSED: [2025-11-26 Wed 13:05] SCHEDULED: <2025-11-07 Fri>
:LOGBOOK:
- State "DONE"       from "TODO"       [2025-11-26 Wed 13:05]
- State "TODO"       from              [2025-11-07 Fri 10:38]
:END:

ssh -L 127.0.0.1:8444:192.168.100.4:443  milad@46.245.89.4 -p 3316

https://127.0.0.1:8444
*** TODO get user name and password from hosein
SCHEDULED: <2025-11-09 Sun>
:LOGBOOK:
- State "TODO"       from              [2025-11-07 Fri 12:03]
:END:
** TODO review vmware
SCHEDULED: <2025-11-27 Thu>
:LOGBOOK:
- State "TODO"       from              [2025-11-26 Wed 13:03]
:END:
** DONE monitoring status of servers
CLOSED: [2025-11-26 Wed 13:03] SCHEDULED: <2025-11-07 Fri>
:LOGBOOK:
- State "DONE"       from "TODO"       [2025-11-26 Wed 13:03]
- State "TODO"       from              [2025-11-07 Fri 10:38]
:END:
** DONE uid vpn
CLOSED: [2025-11-18 Tue 11:29]
:LOGBOOK:
- State "DONE"       from "DOINGNOW"   [2025-11-18 Tue 11:29]
- State "DOINGNOW"   from "DELEGATED"  [2025-11-18 Tue 11:29]
- State "DELEGATED"  from "TODO"       [2025-11-07 Fri 11:23]
- State "TODO"       from              [2025-11-07 Fri 11:22]
:END:
*** DONE create local vpn for hasan
CLOSED: [2025-11-18 Tue 08:52] SCHEDULED: <2025-11-09 Sun>
:LOGBOOK:
- State "DONE"       from "TODO"       [2025-11-18 Tue 08:52]
- State "TODO"       from              [2025-11-09 Sun 09:48]
:END:
*** DONE create local vpn for faraz
CLOSED: [2025-11-18 Tue 08:53] SCHEDULED: <2025-11-09 Sun>
:LOGBOOK:
- State "DONE"       from "TODO"       [2025-11-18 Tue 08:53]
- State "TODO"       from              [2025-11-09 Sun 09:48]
:END:
*** DONE learn how can i create these vpns
CLOSED: [2025-11-18 Tue 09:52]
SCHEDULED: <2025-11-18 Tue>
:LOGBOOK:
- State "DONE"       from "TODO"       [2025-11-18 Tue 09:52]
- Rescheduled from "[2025-11-09 Sun]" on [2025-11-18 Tue 08:53] \\
  just postponed to today
- State "TODO"       from              [2025-11-09 Sun 09:54]
:END:
ssh milad@10.4.4.41 -p 2222

/home/uid/openvpn-install.sh
cert password uid123
**** DONE figure out all the available users in the openvpn
CLOSED: [2025-11-19 Wed 08:34] SCHEDULED: <2025-11-18 Tue>
:LOGBOOK:
- State "DONE"       from "NEXT"       [2025-11-19 Wed 08:34]
- State "NEXT"       from              [2025-11-18 Tue 09:57]
:END:
     1) zara
     2) mzkamali
     3) milad-local
     4) soleymani
     5) hasan
     6) mk-local
     7) faraz-local
     8) hamed-local
**** DONE list all the users in 10.4.4.41 server
CLOSED: [2025-11-26 Wed 13:05] SCHEDULED: <2025-11-19 Wed>
:LOGBOOK:
- State "DONE"       from "NEXT"       [2025-11-26 Wed 13:05]
- State "NEXT"       from              [2025-11-18 Tue 10:09]
:END:
**** DONE figure out the config of microtik to expose this computer
CLOSED: [2025-11-26 Wed 13:05] SCHEDULED: <2025-11-19 Wed>
:LOGBOOK:
- State "DONE"       from "NEXT"       [2025-11-26 Wed 13:05]
- State "NEXT"       from              [2025-11-18 Tue 10:09]
:END:
** List of servers
https://conflu.uid.ir/pages/viewpage.action?spaceKey=DEV&title=asitech
*** 46.245.89.2 monitoring service
ssh milad@46.245.89.2 -p 3316

grafana
elkstack
monitoring
*** 46.245.89.4 ha proxy
/docker/ha/conf
*** 46.245.89.7 minio server
*** 46.245.89.9 gateway kubernates
*** DELEGATED 46.245.89.12 can only be accessed to from 46.245.89.9
:LOGBOOK:
- State "DELEGATED"  from              [2025-11-07 Fri 11:57]
:END:
*** DELEGATED 46.245.89.13
need to be set
:LOGBOOK:
- State "DELEGATED"  from              [2025-11-07 Fri 11:56]
:END:
*** 46.245.89.14
ca
sana
crypto
*** 46.245.89.15
authentication
simplified
bff
** TODO how do i reset passwords in ldap
SCHEDULED: <2025-11-18 Tue>
:LOGBOOK:
- State "TODO"       from              [2025-11-07 Fri 11:35]
:END:
** TODO learn about email server
:LOGBOOK:
- State "TODO"       from              [2025-11-09 Sun 10:31]
:END:
*** DONE fix email server
CLOSED: [2025-11-26 Wed 13:03] SCHEDULED: <2025-11-09 Sun>
:LOGBOOK:
- State "DONE"       from "TODO"       [2025-11-26 Wed 13:03]
- State "TODO"       from              [2025-11-09 Sun 10:31]
:END:
** DONE get access to microtick
CLOSED: [2025-11-19 Wed 08:34] SCHEDULED: <2025-11-18 Tue>
:LOGBOOK:
- State "DONE"       from "NEXT"       [2025-11-19 Wed 08:34]
- State "NEXT"       from              [2025-11-18 Tue 08:54]
:END:
48:8F:5A:4D:40:1A
user milad
password: 58ed57e2-1d6d-461c-830d-135015689239
** DONE get access to hauwi router
CLOSED: [2025-11-26 Wed 13:05] SCHEDULED: <2025-11-18 Tue>
:LOGBOOK:
- State "DONE"       from "NEXT"       [2025-11-26 Wed 13:05]
- State "NEXT"       from              [2025-11-18 Tue 08:54]
:END:
** git and confluence
m.kamali
WY4d5E1EZFf2
** monitoring and alerting system
*** check about basic restart system
*** check about the alerts being changed
*** why i'm no longer receiving alerts
** asiatech panel
https://my.asiatech.ir/

14008858450
p~]4=w?p}ebB!+9u4P^3P~]Tn+f-R
** access to firewall
ssh kvm_user@178.22.120.146
pass: 13281328

connect serial

fortigate user admin
fortigate password 123
** CI/CD

platform infra helm hcarts

ssh milad@192.168.20.58 build service


all the docker compose are located at /docker/



ssh milad@192.168.20.6 backup  server
it needs to be cleaned periodically 

* key issues to be solved
** create a plan that we can detect issues with services in less than 5 minutes
** figure out how we can use N8N
** access to old logs
** access to old backups
** add users meta data to logs for easier tracking
** find a way to alert our customers for service outage
** integrating firewall with our infrastructure
